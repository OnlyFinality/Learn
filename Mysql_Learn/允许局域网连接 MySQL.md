# 允许局域网连接 MySQL

本指南介绍如何配置 MySQL 服务器，以允许从同一局域网内的其他计算机进行连接。默认情况下，MySQL 通常只允许本地连接，这样做是为了安全起见。

**警告：** 允许远程连接会带来安全风险。请确保你的网络环境安全，并仅允许受信任的 IP 地址连接。在生产环境中，应使用更严格的访问控制措施，例如使用防火墙限制访问、使用 SSL 加密连接等。

## 步骤

1.  **登录 MySQL 服务器：**

    使用以下命令以 root 用户身份登录到 MySQL 服务器。将 `root` 替换为你的 root 用户密码。

    ```bash
    mysql -uroot -proot
    ```

    如果你的 root 用户密码不是 `root`，请相应地更改命令。

2.  **选择 `mysql` 数据库：**

    连接成功后，你需要选择 `mysql` 数据库，该数据库存储了用户权限信息。

    ```sql
    use mysql;
    ```

3.  **查询当前用户权限：**

    执行以下查询以查看当前用户的 host 和 user 信息。这有助于你了解当前的权限设置。

    ```sql
    select host, user from user;
    ```

    你应该会看到类似这样的输出：

    ```
    +-----------+------+
    | Host      | User |
    +-----------+------+
    | localhost | root |
    | 127.0.0.1 | root |
    | ::1       | root |
    ...
    +-----------+------+
    ```

    这表明 root 用户只能从本地连接（localhost、127.0.0.1、::1 分别代表 IPv4 和 IPv6 的本地回环地址）。

4.  **更新用户权限以允许远程连接：**

    要允许从任何主机连接，你需要将 root 用户的 host 设置为 `%`。**强烈不建议在生产环境中使用此设置。** 这意味着任何知道你的 root 密码的人都可以连接到你的数据库。

    ```sql
    update user set host = '%' where user = 'root';
    ```

    **更安全的做法是仅允许特定的 IP 地址或 IP 段连接。** 例如，要允许 IP 地址为 `192.168.1.100` 的主机连接，你可以使用以下命令：

    ```sql
    update user set host = '192.168.1.100' where user = 'root';
    ```

    或者，要允许 `192.168.1.0/24` 网段的所有主机连接，你可以使用：

    ```sql
    update user set host = '192.168.1.%' where user = 'root';
    ```

    **创建新用户并授予特定权限是更佳的实践。** 例如，创建一个名为 `remote_user` 的用户，并仅授予其访问特定数据库的权限。

    ```sql
    CREATE USER 'remote_user'@'192.168.1.%' IDENTIFIED BY 'your_password';
    GRANT ALL PRIVILEGES ON your_database.* TO 'remote_user'@'192.168.1.%';
    ```

    请将 `your_password` 替换为一个强密码，`your_database` 替换为你想要授予访问权限的数据库名称。

5.  **刷新权限：**

    执行以下命令以使更改生效。

    ```sql
    flush privileges;
    ```

6.  **退出 MySQL：**

    ```sql
    exit;
    ```

7.  **配置防火墙（如果需要）：**

    如果你的服务器启用了防火墙（例如 `firewalld` 或 `iptables`），你需要打开 MySQL 的默认端口 3306，以允许外部连接。例如，使用 `firewalld`：

    ```bash
    sudo firewall-cmd --permanent --add-port=3306/tcp
    sudo firewall-cmd --reload
    ```

## 总结

通过以上步骤，你就可以配置 MySQL 服务器以允许局域网连接。请记住，安全性至关重要。仅在必要时允许远程连接，并使用强密码和适当的访问控制措施。创建专门用于远程连接的用户，并仅授予其所需的权限，是比使用 root 用户进行远程连接更好的方法。

## 常见问题

*   **连接被拒绝：** 检查防火墙是否允许 3306 端口的流量，以及 MySQL 服务器是否正在运行。同时检查客户端使用的连接参数（主机地址、端口、用户名、密码）是否正确。
*   **使用 `%` host 的安全风险：** 如上所述，使用 `%` host 意味着允许所有主机连接，这非常不安全。强烈建议使用更具体的 IP 地址或 IP 段，或者创建专门的远程用户。
*   **如何使用 MySQL Workbench 等图形工具连接：** 大部分图形工具都提供连接配置界面，你需要填写主机地址（服务器 IP 地址）、端口（默认为 3306）、用户名和密码。

